{% extends 'base.html' %}



{% block content %}
<!-- Add this at the top of your content block -->
<script>
// Global function to initialize all maps
function initMaps() {
    {% for ride in rides %}
    
    (function() {
        const mapElement = document.getElementById('map-{{ ride.id }}');
        if (!mapElement) return;
    
        const map = new google.maps.Map(mapElement, {
            mapTypeId: 'terrain'
        });
    
        const origin = new google.maps.LatLng(
            {{ ride.origin_latitude }},
            {{ ride.origin_longitude }}
        );
        const destination = new google.maps.LatLng(
            {{ ride.destination_latitude}},
            {{ ride.destination_longitude }}
        );
    
        const bounds = new google.maps.LatLngBounds();
        bounds.extend(origin);
        bounds.extend(destination);
        map.fitBounds(bounds);
    
        const decodedPath = google.maps.geometry.encoding.decodePath(
            '{{ ride.selected_route_polyline|escapejs }}'
        );
        
        new google.maps.Polyline({
            path: decodedPath,
            map: map,
            geodesic: true,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
        });
    
        new google.maps.Marker({
            position: origin,
            map: map,
            title: 'Origin'
        });
    
        new google.maps.Marker({
            position: destination,
            map: map,
            title: 'Destination'
        });
    })();

    {% endfor %}
}
</script>

<a href="{% url 'make_ride' %}" class="btn btn-primary">Make a ride</a>

<div class="container">
    {% for ride in rides %}
    <div class="ride-card shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <p class="text-muted mb-0">
                üìÖ {{ ride.start_date }} | üöó {{ ride.distance }} km | ‚è≥ {{ ride.duration }}
            </p>
            <span class="badge bg-warning">{{ ride.status }}</span>
        </div>
        <p><strong>Available seats:</strong> {{ ride.travelers }}</p>
        <span class="badge bg-primary">
            <i class="bi bi-people-fill"></i> {{ ride.applicant_count }} Applicants
        </span>
        <hr>
        <div class="map-container" id="map-{{ ride.id }}"></div>
        <a href="{% url 'apply_for_ride' ride.id %}" class="btn btn-success my-3">Save the Earth</a>
    </div>
    {% empty %}
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> No active rides available at the moment.
    </div>
    {% endfor %}
</div>


<!-- Move the Google Maps API script here and add the callback -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYNmHSbg3hBxI5CFQUWPlJsMPjzcvtzII&libraries=geometry&callback=initMaps" async defer></script>

<style>
    .ride-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        margin: 10px 0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .map-container {
        width: 100%;
        height: 300px;
        border-radius: 8px;
    }

    .ride-card h6 {
        margin-bottom: 10px;
        font-weight: bold;
    }

    .ride-card p {
        margin-bottom: 8px;
    }

    .text-muted {
        color: #6c757d !important;
    }

    .shadow-sm {
        box-shadow: 0 .125rem .25rem rgba(0,0,0,.075) !important;
    }
</style>
{% endblock %}